<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Roulette</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      .roulette-wheel {
        will-change: transform;
      }
    </style>
  </head>

  <body
    class="min-h-screen bg-slate-950 text-gray-200 flex items-center justify-center p-6"
  >
    <div class="w-full max-w-6xl grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- GAME PANEL -->
      <div
        class="bg-slate-900 rounded-2xl shadow-2xl p-6 flex items-center justify-center"
      >
        <div class="relative w-[360px] h-[360px]">
          <!-- Pointer -->
          <div class="absolute top-[-2px] left-1/2 -translate-x-1/2 z-20">
            <div
              class="w-0 h-0 border-l-8 border-r-8 border-t-[18px] border-l-transparent border-r-transparent border-t-yellow-400"
            ></div>
          </div>

          <!-- Wheel -->
          <div
            id="wheel"
            class="roulette-wheel w-full h-full rounded-full border-8 border-emerald-600 shadow-[0_0_40px_rgba(16,185,129,0.6)] transition-transform duration-[4000ms] ease-out relative"
          >

            <!-- Center Image -->
            <img
              src="/images/roulette.png"
              alt=""
              class="absolute inset-1/2 -translate-x-1/2 -translate-y-1/2 w-[350px] h-[350px] object-contain pointer-events-none"
            />
          </div>
        </div>
      </div>

      <!-- UI PANEL -->
      <div class="bg-slate-900 rounded-2xl shadow-2xl p-8 flex flex-col gap-6">
        <div class="text-center">
          <h1 class="text-3xl font-bold tracking-wide">Roulette</h1>
          <p class="text-gray-400 text-sm mt-1">
            Place your bet and spin the wheel
          </p>
        </div>

        <div class="flex flex-col gap-4">
          <div>
            <label class="text-sm text-gray-400">Bet Number (0‚Äì36)</label>
            <input
              id="betNumber"
              type="number"
              min="0"
              max="36"
              placeholder="17"
              class="w-full mt-1 px-4 py-3 rounded-xl bg-slate-800 border border-slate-700 focus:outline-none focus:border-indigo-500"
            />
          </div>

          <div>
            <label class="text-sm text-gray-400">Bet Amount</label>
            <input
              id="betAmount"
              type="number"
              min="1"
              placeholder="100"
              class="w-full mt-1 px-4 py-3 rounded-xl bg-slate-800 border border-slate-700 focus:outline-none focus:border-indigo-500"
            />
          </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <button
            id="betBtn"
            class="py-3 rounded-xl font-semibold bg-indigo-600 hover:bg-indigo-500 active:scale-95 transition"
          >
            Place Bet
          </button>
          <button
            id="spinBtn"
            class="py-3 rounded-xl font-semibold bg-emerald-500 text-slate-900 hover:bg-emerald-400 active:scale-95 transition"
          >
            Spin
          </button>
        </div>

        <div
          id="status"
          class="text-center py-3 rounded-xl bg-slate-800 font-medium"
        >
          üéØ Waiting for bet
        </div>
      </div>
    </div>

    <!-- JS -->
    <script>
      const API = "http://localhost:30106/api/v1";
      const gameId = window.location.pathname.split("/").pop();

      const betNumber = document.getElementById("betNumber");
      const betAmount = document.getElementById("betAmount");
      const status = document.getElementById("status");
      const betBtn = document.getElementById("betBtn");
      const spinBtn = document.getElementById("spinBtn");
      const wheel = document.getElementById("wheel");

      let currentRotation = 0;

      function spinWheel(resultNumber) {
        const segmentAngle = 360 / 37;
        const randomOffset = Math.random() * segmentAngle;

        const targetRotation =
          360 * 6 + (360 - resultNumber * segmentAngle) + randomOffset;

        currentRotation += targetRotation;
        wheel.style.transform = `rotate(${currentRotation}deg)`;
      }

      async function placeBet() {
        const number = Number(betNumber.value);
        const amount = Number(betAmount.value);

        if (number < 0 || number > 36 || amount <= 0) {
          status.textContent = "‚ùå Invalid bet";
          return;
        }

        const res = await fetch(`${API}/roulette/${gameId}/bet`, {
          method: "POST",
          credentials: "include",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ number, amount }),
        });

        if (!res.ok) {
          status.textContent = "‚ùå Bet failed";
          return;
        }

        status.textContent = "‚úÖ Bet placed";
      }

      async function spin() {
        const res = await fetch(`${API}/roulette/${gameId}/spin`, {
          method: "POST",
          credentials: "include",
        });

        const data = await res.json();

        if (!res.ok) {
          status.textContent = `‚ùå ${data.error}`;
          return;
        }

        spinWheel(data.result);
        console.log(data)

        status.textContent =
          data.winAmount > 0 ? `üéâ You won ${data.winAmount}` : "‚ùå You lost";
      }

      betBtn.onclick = placeBet;
      spinBtn.onclick = spin;
    </script>
  </body>
</html>
